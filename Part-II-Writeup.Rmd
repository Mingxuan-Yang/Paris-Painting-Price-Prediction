---
title: "homework"
author: "Machao Deng"
date: "2019Äê12ÔÂ14ÈÕ"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(dplyr)
library(knitr)
library(BAS)
library(devtools)
library(tidyr)
library(ggplot2)
library(glmnet)
```

```{r}
library(ISLR)
library(tidyverse)
library(tree)
library(caret)
library(gbm)
library(randomForest)
library(gtools)
library(glmnet)
library(BART)
library(BAS)
```




```{r}
model = bas.lm(logprice~., data=paintings_train_new, prior = 'JZS',modelprior=uniform(),method='MCMC')


model_bas <- bas.lm(logprice~.,
  data = paintings_train_new,
  prior = "g-prior",
  alpha = dim(paintings_train_new)[1],
  modelprior = uniform(),
  method = "deterministic")
ytrain=predict(model_bas,paintings_train_new,estimator="BMA")
rmse=(mean(ytrain-paintings_train_new$logprice)^2)
yhat=predict(model_bas,paintings_test_new,estimator="HPM")
interval=c(quantile(yhat,0.025)-1.96*rmse,quantile(yhat,0.975)+1.96*rmse)
fit=yhat
lwr=interval[1]
upr=interval[2]
predictions=data.frame(fit,lwr,upr)
save(predictions,file="predict-test.Rdata")
```



```{r}
set.seed(3)
trainX = model.matrix(logprice ~ .,data=paintings_train_new)[,-1]
testX = model.matrix(logprice ~ .,data=paintings_test_new%>%mutate(logprice=0))[,-1]
Y = paintings_train_new$logprice
cv.lasso = glmnet::cv.glmnet(x = trainX, y = Y, family = "gaussian")
bestlam = cv.lasso$lambda.min
glmnet.OJ<- glmnet::glmnet(x = trainX, y = Y, family = "gaussian", lambda = bestlam)
ytrain = predict(glmnet.OJ, newx = trainX)
rmse=sqrt(mean(ytrain-paintings_train_new$logprice)^2)
ytest = predict(glmnet.OJ, newx = testX)
interval=c(quantile(ytest,0.025)-1.96*rmse,quantile(ytest,0.975)+1.96*rmse)
fit=ytest
lwr=interval[1]
upr=interval[2]
predictions=data.frame(fit,lwr,upr)
save(predictions,file="predict-test.Rdata")
```



random forest
```{r}
set.seed(10)
forest=randomForest(logprice~.,data=paintings_train_new,mtry=7,importance=TRUE)
yhat2=predict(forest,paintings_train_new)
rmse2=sqrt(mean((yhat2-paintings_train_new$logprice)^2))

#bootstrap to calculate the prediction interval
mean=matrix(NA,nrow=30,ncol=750)
for(i in 1:30){
  bootstrap=sample_n(paintings_train_new,1300,replace = TRUE)
  bootstrap_tree=randomForest(logprice~.,data=bootstrap,mtry=7,importance=TRUE)
  yhat=predict(bootstrap_tree,paintings_test_new)
  mean[i,]=yhat
}
means=colMeans(mean)
interval=c(quantile(means,0.025)-1.96*rmse2,quantile(means,0.975)+1.96*rmse2)
fit=exp(means)
lwr=exp(interval[1])
upr=exp(interval[2])
predictions=data.frame(fit,lwr,upr)
save(predictions,file="predict-test.Rdata")
```



